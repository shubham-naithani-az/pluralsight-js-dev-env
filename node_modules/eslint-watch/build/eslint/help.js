"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = eslintHelp;

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("../logger"));

var _cli = _interopRequireDefault(require("./cli"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const logger = (0, _logger.default)('eslint-help');
logger.debug('Loaded');
const namedOption = /^--/;

function parseNo(option, str) {
  if (!str) return;
  let cmd = str.replace('--', '');

  if (/no-/.test(cmd)) {
    logger.debug('Parsing no option', str);
    cmd = cmd.replace('no-', '');
    option.default = 'true';
  }

  option.option = cmd;
  return option;
}

function parseDouble(arr) {
  const description = _lodash.default.without(arr.slice(2), '').join(' ');

  return {
    option: arr[0].replace('--', ''),
    type: 'Boolean',
    alias: arr[1].replace('--', ''),
    description: description
  };
}

function parseRegular(arr) {
  logger.debug('Parsing %s', arr[0]);

  if (!arr[0]) {
    return;
  }

  const optionText = arr[0];
  const type = arr[1] || 'Boolean';
  const option = parseNo({}, optionText);

  const helpText = _lodash.default.without(arr, optionText, type, '');

  const description = helpText.join(' ');
  option.type = type;

  if (description) {
    option.description = description;
  }

  return option;
}

function parseAlias(arr) {
  const alias = arr[0];
  logger.debug('Alias found: %s', alias);
  const option = parseRegular(_lodash.default.without(arr, alias));

  if (alias) {
    option.alias = alias.replace('-', '');
  }

  return option;
}

function createOption(arr) {
  let option;

  if (namedOption.test(arr[0]) && namedOption.test(arr[1])) {
    // no alias defaulted boolean
    option = parseDouble(arr);
  } else if (namedOption.test(arr[0]) && !namedOption.test(arr[1])) {
    // just a no alias
    option = parseRegular(arr);
  } else {
    // aliased or other
    option = parseAlias(arr);
  }

  return _lodash.default.isEmpty(option) ? undefined : option;
}

function parseHelp(helpText) {
  let helpArr = helpText.split('\n');
  let previousLine = [];
  return _lodash.default.without(_lodash.default.map(helpArr, (row, index) => {
    if (index <= 2) {
      return;
    }

    let str = row.replace(',', '');
    let arr = str.trim().split(' ');

    if (str.indexOf('-') >= 0 && previousLine[0] !== '') {
      let option = createOption(arr);

      if (option && option.option !== 'format' && option.option !== 'help') {
        return option;
      }
    }

    previousLine = arr;
  }), undefined);
}

function eslintHelp() {
  logger.debug('Executing help');
  const result = (0, _cli.default)(['--help'], {
    stdio: [process.stdin, null, process.stderr]
  });

  if (!result.message) {
    throw new Error('Help text not received from Eslint.');
  }

  const eslintOptions = parseHelp(result.message);
  return eslintOptions;
}

;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lc2xpbnQvaGVscC5qcyJdLCJuYW1lcyI6WyJsb2dnZXIiLCJkZWJ1ZyIsIm5hbWVkT3B0aW9uIiwicGFyc2VObyIsIm9wdGlvbiIsInN0ciIsImNtZCIsInJlcGxhY2UiLCJ0ZXN0IiwiZGVmYXVsdCIsInBhcnNlRG91YmxlIiwiYXJyIiwiZGVzY3JpcHRpb24iLCJfIiwid2l0aG91dCIsInNsaWNlIiwiam9pbiIsInR5cGUiLCJhbGlhcyIsInBhcnNlUmVndWxhciIsIm9wdGlvblRleHQiLCJoZWxwVGV4dCIsInBhcnNlQWxpYXMiLCJjcmVhdGVPcHRpb24iLCJpc0VtcHR5IiwidW5kZWZpbmVkIiwicGFyc2VIZWxwIiwiaGVscEFyciIsInNwbGl0IiwicHJldmlvdXNMaW5lIiwibWFwIiwicm93IiwiaW5kZXgiLCJ0cmltIiwiaW5kZXhPZiIsImVzbGludEhlbHAiLCJyZXN1bHQiLCJzdGRpbyIsInByb2Nlc3MiLCJzdGRpbiIsInN0ZGVyciIsIm1lc3NhZ2UiLCJFcnJvciIsImVzbGludE9wdGlvbnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFDQTs7OztBQUVBLE1BQU1BLFNBQVMscUJBQU8sYUFBUCxDQUFmO0FBQ0FBLE9BQU9DLEtBQVAsQ0FBYSxRQUFiO0FBRUEsTUFBTUMsY0FBYyxLQUFwQjs7QUFFQSxTQUFTQyxPQUFULENBQWlCQyxNQUFqQixFQUF5QkMsR0FBekIsRUFBOEI7QUFDNUIsTUFBSSxDQUFDQSxHQUFMLEVBQVU7QUFFVixNQUFJQyxNQUFNRCxJQUFJRSxPQUFKLENBQVksSUFBWixFQUFrQixFQUFsQixDQUFWOztBQUVBLE1BQUksTUFBTUMsSUFBTixDQUFXRixHQUFYLENBQUosRUFBcUI7QUFDbkJOLFdBQU9DLEtBQVAsQ0FBYSxtQkFBYixFQUFrQ0ksR0FBbEM7QUFDQUMsVUFBTUEsSUFBSUMsT0FBSixDQUFZLEtBQVosRUFBbUIsRUFBbkIsQ0FBTjtBQUNBSCxXQUFPSyxPQUFQLEdBQWlC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QjtBQUM5QyxRQUFJQSxTQUFTLENBQWIsRUFBZ0I7QUFDZDtBQUNEOztBQUNELFFBQUkzQixNQUFNMEIsSUFBSXhCLE9BQUosQ0FBWSxHQUFaLEVBQWlCLEVBQWpCLENBQVY7QUFDQSxRQUFJSSxNQUFNTixJQUFJNEIsSUFBSixHQUFXTCxLQUFYLENBQWlCLEdBQWpCLENBQVY7O0FBQ0EsUUFBSXZCLElBQUk2QixPQUFKLENBQVksR0FBWixLQUFvQixDQUFwQixJQUF5QkwsYUFBYSxDQUFiLE1BQW9CLEVBQWpELEVBQXFEO0FBQ25ELFVBQUl6QixTQUFTbUIsYUFBYVosR0FBYixDQUFiOztBQUNBLFVBQUlQLFVBQVVBLE9BQU9BLE1BQVAsS0FBa0IsUUFBNUIsSUFBd0NBLE9BQU9BLE1BQVAsS0FBa0IsTUFBOUQsRUFBc0U7QUFDcEUsZUFBT0EsTUFBUDtBQUNEO0FBQ0Y7O0FBQ0R5QixtQkFBZWxCLEdBQWY7QUFDRCxHQWJnQixDQUFWLEVBYUhjLFNBYkcsQ0FBUDtBQWNEOztBQUVjLFNBQVNVLFVBQVQsR0FBc0I7QUFDbkNuQyxTQUFPQyxLQUFQLENBQWEsZ0JBQWI7QUFDQSxRQUFNbUMsU0FBUyxrQkFBTyxDQUFDLFFBQUQsQ0FBUCxFQUFtQjtBQUFFQyxXQUFPLENBQUVDLFFBQVFDLEtBQVYsRUFBaUIsSUFBakIsRUFBdUJELFFBQVFFLE1BQS9CO0FBQVQsR0FBbkIsQ0FBZjs7QUFDQSxNQUFJLENBQUNKLE9BQU9LLE9BQVosRUFBcUI7QUFDbkIsVUFBTSxJQUFJQyxLQUFKLENBQVUscUNBQVYsQ0FBTjtBQUNEOztBQUNELFFBQU1DLGdCQUFnQmpCLFVBQVVVLE9BQU9LLE9BQWpCLENBQXRCO0FBQ0EsU0FBT0UsYUFBUDtBQUNEOztBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IExvZ2dlciBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IGVzbGludCBmcm9tICcuL2NsaSc7XG5cbmNvbnN0IGxvZ2dlciA9IExvZ2dlcignZXNsaW50LWhlbHAnKTtcbmxvZ2dlci5kZWJ1ZygnTG9hZGVkJyk7XG5cbmNvbnN0IG5hbWVkT3B0aW9uID0gL14tLS87XG5cbmZ1bmN0aW9uIHBhcnNlTm8ob3B0aW9uLCBzdHIpIHtcbiAgaWYgKCFzdHIpIHJldHVybjtcblxuICBsZXQgY21kID0gc3RyLnJlcGxhY2UoJy0tJywgJycpO1xuXG4gIGlmICgvbm8tLy50ZXN0KGNtZCkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1BhcnNpbmcgbm8gb3B0aW9uJywgc3RyKTtcbiAgICBjbWQgPSBjbWQucmVwbGFjZSgnbm8tJywgJycpO1xuICAgIG9wdGlvbi5kZWZhdWx0ID0gJ3RydWUnO1xuICB9XG5cbiAgb3B0aW9uLm9wdGlvbiA9IGNtZDtcblxuICByZXR1cm4gb3B0aW9uO1xufVxuXG5mdW5jdGlvbiBwYXJzZURvdWJsZShhcnIpIHtcbiAgY29uc3QgZGVzY3JpcHRpb24gPSBfLndpdGhvdXQoYXJyLnNsaWNlKDIpLCcnKS5qb2luKCcgJyk7XG5cbiAgcmV0dXJuIHtcbiAgICBvcHRpb246IGFyclswXS5yZXBsYWNlKCctLScsICcnKSxcbiAgICB0eXBlOiAnQm9vbGVhbicsXG4gICAgYWxpYXM6IGFyclsxXS5yZXBsYWNlKCctLScsICcnKSxcbiAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb25cbiAgfTtcbn1cblxuZnVuY3Rpb24gcGFyc2VSZWd1bGFyKGFycikge1xuICBsb2dnZXIuZGVidWcoJ1BhcnNpbmcgJXMnLCBhcnJbMF0pO1xuXG4gIGlmICghYXJyWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgb3B0aW9uVGV4dCA9IGFyclswXTtcbiAgY29uc3QgdHlwZSA9IGFyclsxXSB8fCAnQm9vbGVhbic7XG4gIGNvbnN0IG9wdGlvbiA9IHBhcnNlTm8oe30sIG9wdGlvblRleHQpO1xuICBjb25zdCBoZWxwVGV4dCA9IF8ud2l0aG91dChhcnIsIG9wdGlvblRleHQsIHR5cGUsICcnKTtcbiAgY29uc3QgZGVzY3JpcHRpb24gPSBoZWxwVGV4dC5qb2luKCcgJyk7XG5cbiAgb3B0aW9uLnR5cGUgPSB0eXBlO1xuXG4gIGlmIChkZXNjcmlwdGlvbikge1xuICAgIG9wdGlvbi5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICB9XG5cbiAgcmV0dXJuIG9wdGlvbjtcbn1cblxuZnVuY3Rpb24gcGFyc2VBbGlhcyhhcnIpIHtcbiAgY29uc3QgYWxpYXMgPSBhcnJbMF07XG4gIGxvZ2dlci5kZWJ1ZygnQWxpYXMgZm91bmQ6ICVzJywgYWxpYXMpO1xuICBjb25zdCBvcHRpb24gPSBwYXJzZVJlZ3VsYXIoXy53aXRob3V0KGFyciwgYWxpYXMpKTtcblxuICBpZiAoYWxpYXMpIHtcbiAgICBvcHRpb24uYWxpYXMgPSBhbGlhcy5yZXBsYWNlKCctJywnJyk7XG4gIH1cblxuICByZXR1cm4gb3B0aW9uO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVPcHRpb24oYXJyKSB7XG4gIGxldCBvcHRpb247XG5cbiAgaWYgKG5hbWVkT3B0aW9uLnRlc3QoYXJyWzBdKSAmJiBuYW1lZE9wdGlvbi50ZXN0KGFyclsxXSkpIHsgLy8gbm8gYWxpYXMgZGVmYXVsdGVkIGJvb2xlYW5cbiAgICBvcHRpb24gPSBwYXJzZURvdWJsZShhcnIpO1xuICB9IGVsc2UgaWYgKG5hbWVkT3B0aW9uLnRlc3QoYXJyWzBdKSAmJiAhbmFtZWRPcHRpb24udGVzdChhcnJbMV0pKSB7IC8vIGp1c3QgYSBubyBhbGlhc1xuICAgIG9wdGlvbiA9IHBhcnNlUmVndWxhcihhcnIpO1xuICB9IGVsc2Ugey8vIGFsaWFzZWQgb3Igb3RoZXJcbiAgICBvcHRpb24gPSBwYXJzZUFsaWFzKGFycik7XG4gIH1cblxuICByZXR1cm4gXy5pc0VtcHR5KG9wdGlvbikgPyB1bmRlZmluZWQgOiBvcHRpb247XG59XG5cbmZ1bmN0aW9uIHBhcnNlSGVscChoZWxwVGV4dCkge1xuICBsZXQgaGVscEFyciA9IGhlbHBUZXh0LnNwbGl0KCdcXG4nKTtcbiAgbGV0IHByZXZpb3VzTGluZSA9IFtdO1xuXG4gIHJldHVybiBfLndpdGhvdXQoXy5tYXAoaGVscEFyciwgKHJvdywgaW5kZXgpID0+IHtcbiAgICBpZiAoaW5kZXggPD0gMikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgc3RyID0gcm93LnJlcGxhY2UoJywnLCAnJyk7XG4gICAgbGV0IGFyciA9IHN0ci50cmltKCkuc3BsaXQoJyAnKTtcbiAgICBpZiAoc3RyLmluZGV4T2YoJy0nKSA+PSAwICYmIHByZXZpb3VzTGluZVswXSAhPT0gJycpIHtcbiAgICAgIGxldCBvcHRpb24gPSBjcmVhdGVPcHRpb24oYXJyKTtcbiAgICAgIGlmIChvcHRpb24gJiYgb3B0aW9uLm9wdGlvbiAhPT0gJ2Zvcm1hdCcgJiYgb3B0aW9uLm9wdGlvbiAhPT0gJ2hlbHAnKSB7XG4gICAgICAgIHJldHVybiBvcHRpb247XG4gICAgICB9XG4gICAgfVxuICAgIHByZXZpb3VzTGluZSA9IGFycjtcbiAgfSksIHVuZGVmaW5lZCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGVzbGludEhlbHAoKSB7XG4gIGxvZ2dlci5kZWJ1ZygnRXhlY3V0aW5nIGhlbHAnKTtcbiAgY29uc3QgcmVzdWx0ID0gZXNsaW50KFsnLS1oZWxwJ10sIHsgc3RkaW86IFsgcHJvY2Vzcy5zdGRpbiwgbnVsbCwgcHJvY2Vzcy5zdGRlcnJdIH0pO1xuICBpZiAoIXJlc3VsdC5tZXNzYWdlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdIZWxwIHRleHQgbm90IHJlY2VpdmVkIGZyb20gRXNsaW50LicpO1xuICB9XG4gIGNvbnN0IGVzbGludE9wdGlvbnMgPSBwYXJzZUhlbHAocmVzdWx0Lm1lc3NhZ2UpO1xuICByZXR1cm4gZXNsaW50T3B0aW9ucztcbn07XG4iXX0=